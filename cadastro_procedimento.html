<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Procedimentos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos Globais Scarparo */
        :root {
            --color-black-rich: #121212; --color-white-bg: #F4F6F9; --color-white-pure: #FFFFFF;
            --color-gold-matte: #B9965B; --color-gold-light: #F5EFE6;
            --color-text-dark: #333333; --color-text-gray: #757575;
            --color-gray-border: #E0E0E0; --color-success: #27AE60; --color-danger: #E74C3C;
            --color-info-bg: #e0f2fe; --color-info-text: #0284c7; --color-info-border: #bae6fd;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--color-white-bg); padding: 1.5rem; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Header */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-shrink: 0; }
        .page-title h2 { font-size: 1.5rem; font-weight: 600; color: var(--color-black-rich); margin: 0; }
        .page-title p { color: var(--color-text-gray); font-size: 0.9rem; margin: 0; }

        .btn-gold { background-color: var(--color-gold-matte); color: var(--color-black-rich); border: none; padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-gold:hover { background-color: #a3844a; transform: translateY(-2px); }

        /* Search Bar */
        .search-bar-container { background: var(--color-white-pure); padding: 1rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 1rem; display: flex; gap: 1rem; flex-shrink: 0; }
        .search-input { flex: 1; padding: 0.8rem; border: 1px solid var(--color-gray-border); border-radius: 6px; outline: none; }
        .search-input:focus { border-color: var(--color-gold-matte); }

        /* Lista */
        .list-container { flex: 1; background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); display: flex; flex-direction: column; overflow: hidden; }
        .list-header { padding: 1rem 1.5rem; border-bottom: 1px solid #eee; font-weight: 600; color: var(--color-text-dark); background: #fafafa; display: grid; grid-template-columns: 1fr 150px 100px; }
        .list-body { overflow-y: auto; flex: 1; }
        .list-item { display: grid; grid-template-columns: 1fr 150px 100px; padding: 1rem 1.5rem; border-bottom: 1px solid #f0f0f0; align-items: center; transition: 0.2s; }
        .list-item:hover { background-color: #f9f9f9; }
        .item-price { font-weight: 600; color: var(--color-black-rich); }
        .item-actions { display: flex; gap: 10px; justify-content: flex-end; }
        
        .btn-icon { background: none; border: 1px solid var(--color-gray-border); border-radius: 6px; padding: 6px; cursor: pointer; color: var(--color-text-gray); transition: 0.2s; }
        .btn-icon:hover { background-color: #eee; color: #333; }
        .btn-delete:hover { background-color: #FDEDEC; color: var(--color-danger); border-color: #f5c6cb; }

        .no-results { padding: 2rem; text-align: center; color: #888; }

        /* --- MODAL FORMUL√ÅRIO --- */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900; backdrop-filter: blur(2px); }
        .form-container { background: var(--color-white-pure); padding: 2rem; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; z-index: 1000; border: 1px solid var(--color-gray-border); }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; }
        .form-label { font-size: 0.9rem; font-weight: 500; color: var(--color-text-dark); }
        .form-control { padding: 0.8rem; border: 1px solid var(--color-gray-border); border-radius: 6px; outline: none; background-color: #FAFAFA; }
        .form-control:focus { border-color: var(--color-gold-matte); background: #fff; }
        
        .btn-action { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; font-size: 0.85rem; transition: 0.2s; }
        .btn-cancel { background: #eee; color: #333; }
        .btn-confirm-delete { background-color: var(--color-danger); color: white; }

        /* --- MODAL CONFIRMA√á√ÉO --- */
        .confirm-modal-box { 
            background: white; padding: 2rem; border-radius: 12px; width: 100%; max-width: 400px; 
            text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 1001; display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
        }
        .confirm-title { font-size: 1.2rem; font-weight: 600; color: var(--color-black-rich); margin-bottom: 1rem; }
        .confirm-text { color: var(--color-text-gray); margin-bottom: 2rem; font-size: 0.95rem; }
        .confirm-actions { display: flex; justify-content: center; gap: 1rem; }

        /* --- TOAST NOTIFICATION --- */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { min-width: 250px; padding: 15px 20px; border-radius: 8px; color: white; font-size: 0.9rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideIn 0.3s ease; display: flex; align-items: center; justify-content: space-between; }
        .toast-success { background-color: var(--color-success); }
        .toast-error { background-color: var(--color-danger); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="toast-container"></div>
    <div id="modal-overlay" class="overlay"></div>

    <div id="delete-confirmation-modal" class="confirm-modal-box">
        <h3 class="confirm-title" style="color: var(--color-danger);">Excluir Procedimento?</h3>
        <p class="confirm-text">Deseja realmente remover este procedimento da lista?</p>
        <div class="confirm-actions">
            <button class="btn-action btn-cancel" onclick="closeDeleteModal()">Cancelar</button>
            <button class="btn-action btn-confirm-delete" onclick="executeDelete()">Sim, Excluir</button>
        </div>
    </div>

    <div class="page-header">
        <div class="page-title">
            <h2>Procedimentos</h2>
            <p>Gerencie a tabela de pre√ßos da cl√≠nica.</p>
        </div>
        <button class="btn-gold" onclick="openForm()">
            <svg style="width:16px; height:16px; fill:currentColor; margin-right:5px;" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Novo Procedimento
        </button>
    </div>

    <div class="search-bar-container">
        <input type="text" id="search-input" class="search-input" placeholder="Pesquisar procedimento..." onkeyup="searchProcedures()">
    </div>

    <div class="list-container">
        <div class="list-header">
            <span>Descri√ß√£o</span>
            <span>Valor</span>
            <span style="text-align: right;">A√ß√µes</span>
        </div>
        <div class="list-body" id="procedures-list">
            </div>
    </div>

    <div id="proc-form" class="form-container">
        <h3 id="form-title" style="margin-bottom: 1.5rem; color: var(--color-black-rich);">Novo Procedimento</h3>
        <input type="hidden" id="proc-id">
        
        <div class="form-group">
            <label class="form-label">Nome do Procedimento</label>
            <input type="text" id="proc-name" class="form-control" placeholder="Ex: Limpeza Simples">
        </div>
        
        <div class="form-group">
            <label class="form-label">Valor (R$)</label>
            <input type="number" id="proc-price" class="form-control" placeholder="0.00" step="0.01">
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
            <button class="btn-action btn-cancel" onclick="closeForm()">Cancelar</button>
            <button class="btn-gold" onclick="saveProcedure()">Salvar</button>
        </div>
    </div>

    <script>
        let procedures = [];
        let pendingDeleteId = null; // Guarda o ID que ser√° exclu√≠do

        // Dados iniciais (se estiver vazio)
        const defaultProcedures = [
            { id: 1, name: "Consulta Avalia√ß√£o", price: 150.00 },
            { id: 2, name: "Limpeza (Profilaxia)", price: 250.00 },
            { id: 3, name: "Restaura√ß√£o Resina (Simples)", price: 300.00 },
            { id: 4, name: "Restaura√ß√£o Resina (Complexa)", price: 450.00 },
            { id: 5, name: "Tratamento de Canal (Anterior)", price: 800.00 },
            { id: 6, name: "Tratamento de Canal (Molar)", price: 1200.00 },
            { id: 7, name: "Implante Unit√°rio (Completo)", price: 3500.00 },
            { id: 8, name: "Clareamento Consult√≥rio", price: 900.00 },
            { id: 9, name: "Extra√ß√£o Simples", price: 200.00 },
            { id: 10, name: "Extra√ß√£o Siso", price: 400.00 }
        ];

        window.onload = function() {
            const stored = localStorage.getItem('scarparo_procedures');
            if (stored) {
                procedures = JSON.parse(stored);
            } else {
                procedures = defaultProcedures;
                localStorage.setItem('scarparo_procedures', JSON.stringify(procedures));
            }
            renderList();
        };

        function renderList() {
            const container = document.getElementById('procedures-list');
            const term = document.getElementById('search-input').value.toLowerCase();
            container.innerHTML = '';

            let filtered = procedures.filter(p => p.name.toLowerCase().includes(term));

            if (filtered.length === 0) {
                container.innerHTML = '<div class="no-results">Nenhum procedimento encontrado.</div>';
                return;
            }

            // Ordena por ID Decrescente
            filtered.sort((a, b) => b.id - a.id);

            filtered.forEach(p => {
                const html = `
                <div class="list-item">
                    <span>${p.name}</span>
                    <span class="item-price">R$ ${parseFloat(p.price).toFixed(2)}</span>
                    <div class="item-actions">
                        <button class="btn-icon" onclick="editProcedure(${p.id})" title="Editar">‚úé</button>
                        <button class="btn-icon btn-delete" onclick="openDeleteModal(${p.id})" title="Excluir">üóë</button>
                    </div>
                </div>
                `;
                container.innerHTML += html;
            });
        }

        function searchProcedures() {
            renderList();
        }

        // --- CRUD ---
        function openForm() {
            document.getElementById('proc-id').value = '';
            document.getElementById('proc-name').value = '';
            document.getElementById('proc-price').value = '';
            document.getElementById('form-title').innerText = 'Novo Procedimento';
            document.getElementById('proc-form').style.display = 'block';
            document.getElementById('modal-overlay').style.display = 'block';
        }

        function closeForm() {
            document.getElementById('proc-form').style.display = 'none';
            document.getElementById('modal-overlay').style.display = 'none';
        }

        function saveProcedure() {
            const id = document.getElementById('proc-id').value;
            const name = document.getElementById('proc-name').value;
            const price = parseFloat(document.getElementById('proc-price').value);

            if (!name || isNaN(price)) {
                showToast("Preencha o nome e o valor corretamente.", "error");
                return;
            }

            if (id) {
                const index = procedures.findIndex(p => p.id == id);
                if (index > -1) {
                    procedures[index] = { id: parseInt(id), name, price };
                    showToast("Procedimento atualizado com sucesso!", "success");
                }
            } else {
                const newId = procedures.length > 0 ? Math.max(...procedures.map(p => p.id)) + 1 : 1;
                procedures.push({ id: newId, name, price });
                showToast("Procedimento cadastrado com sucesso!", "success");
            }

            localStorage.setItem('scarparo_procedures', JSON.stringify(procedures));
            renderList();
            closeForm();
        }

        function editProcedure(id) {
            const p = procedures.find(item => item.id == id);
            if (p) {
                document.getElementById('proc-id').value = p.id;
                document.getElementById('proc-name').value = p.name;
                document.getElementById('proc-price').value = p.price;
                document.getElementById('form-title').innerText = 'Editar Procedimento';
                document.getElementById('proc-form').style.display = 'block';
                document.getElementById('modal-overlay').style.display = 'block';
            }
        }

        // --- L√ìGICA DE EXCLUS√ÉO COM MODAL ---
        function openDeleteModal(id) {
            pendingDeleteId = id;
            document.getElementById('delete-confirmation-modal').style.display = 'block';
            document.getElementById('modal-overlay').style.display = 'block';
        }

        function closeDeleteModal() {
            document.getElementById('delete-confirmation-modal').style.display = 'none';
            document.getElementById('modal-overlay').style.display = 'none';
            pendingDeleteId = null;
        }

        function executeDelete() {
            if (pendingDeleteId) {
                procedures = procedures.filter(p => p.id != pendingDeleteId);
                localStorage.setItem('scarparo_procedures', JSON.stringify(procedures));
                renderList();
                showToast("Procedimento exclu√≠do.", "success");
                closeDeleteModal();
            }
        }

        // --- TOAST NOTIFICATION SYSTEM ---
        function showToast(message, type) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerText = message;
            
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>